# CLAUDE.md - LabReportAI Project Design Reference

> **Version:** 1.0.0  
> **Last Updated:** 2026-01-30  
> **Status:** Ready for Development

---

## 1. Project Overview

### 1.1 í”„ë¡œì íŠ¸ ì •ì˜

**LabReportAI**ëŠ” ì´ê³µê³„ ëŒ€í•™ìƒì„ ìœ„í•œ **ì‹¤í—˜ ë°ì´í„° ë¶„ì„ ë° ë¦¬í¬íŠ¸ ì´ˆì•ˆ ìë™ ìƒì„±ê¸°**ì´ë‹¤.

ì‚¬ìš©ìê°€ ì‹¤í—˜ ë°ì´í„°(CSV/Excel)ë§Œ ì—…ë¡œë“œí•˜ë©´, 30ì´ˆ ë‚´ì— ë‹¤ìŒì„ ìë™ ìƒì„±í•œë‹¤:
- ğŸ“Š **ì¶”ì„¸ì„  ê·¸ë˜í”„** (ë…¼ë¬¸ í’ˆì§ˆ PNG ì´ë¯¸ì§€)
- ğŸ“ˆ **í†µê³„ ë¶„ì„ ê²°ê³¼** (RÂ², ê¸°ìš¸ê¸°, ì ˆí¸, ì˜¤ì°¨ìœ¨)
- ğŸ“ **ì„œë¡  ë° ê³ ì°°(Discussion) ì´ˆì•ˆ** (í•™ìˆ ì  ì–´ì¡°, ì˜¤ì°¨ ì›ì¸ ë¶„ì„ í¬í•¨)

### 1.2 Core Value Proposition

> **"ë°ì´í„°ë§Œ ì£¼ë©´, ê·¸ë˜í”„ì™€ ê³ ì°°ì€ ë‚´ê°€ ì¨ì¤„ê²Œ."**  
> (Data-First, Text-Second)

### 1.3 í•´ê²°í•˜ëŠ” ë¬¸ì œ

| ë¬¸ì œ | í˜„ì¬ ìƒí™© | LabReportAI ì†”ë£¨ì…˜ |
|------|----------|-------------------|
| ì—‘ì…€ ë…¸ê°€ë‹¤ | ë°ì´í„° ì •ë¦¬ì— 30ë¶„ ì´ìƒ ì†Œìš” | ìë™ ì „ì²˜ë¦¬ ë° í†µê³„ ê³„ì‚° |
| ê·¸ë˜í”„ ì‘ì„± | Excel/Origin ì¡°ì‘ ë¯¸ìˆ™, ì¼ê´€ì„± ë¶€ì¡± | ë…¼ë¬¸ í‘œì¤€ ê·¸ë˜í”„ ìë™ ìƒì„± |
| ê³ ì°° ì‘ì„± ë§‰ë§‰í•¨ | "ë­˜ ì¨ì•¼ í• ì§€ ëª¨ë¥´ê² ì–´ìš”" | AI ê¸°ë°˜ ë§¥ë½ ì¸ì‹ ì´ˆì•ˆ ìƒì„± |
| ì˜¤ì°¨ ë¶„ì„ | ì˜¤ì°¨ ì›ì¸ íŒŒì•… ì–´ë ¤ì›€ | ì‹¤í—˜ë³„ í”„ë¦¬ì…‹ ê¸°ë°˜ ê°€ì´ë“œ ì œê³µ |

### 1.4 Team Assets

- **CEO (ë¬¼ë¦¬í•™ê³¼):** ì‹¤í—˜ ì˜¤ì°¨ ì›ì¸ ë¶„ì„ ë¡œì§ ì„¤ê³„, ë¦¬í¬íŠ¸ í‘œì¤€ ì–‘ì‹ ì •ì˜
- **CTO (AI ê°œë°œì):** Python ë¶„ì„ ì—”ì§„ êµ¬ì¶•, AI íŒŒì´í”„ë¼ì¸ ìµœì í™”

---

## 2. User Flow (MVP)

### 2.1 4-Step Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          LabReportAI User Flow                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  [Step 1: UPLOAD]          [Step 2: ANALYSIS]        [Step 3: DRAFTING]        [Step 4: EXPORT]
       â”‚                          â”‚                         â”‚                        â”‚
       â–¼                          â–¼                         â–¼                        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ CSV/XLS â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚ Python Core â”‚â”€â”€â”€â”€â”€â”€â–¶    â”‚  GPT-4o API â”‚â”€â”€â”€â”€â”€â”€â–¶   â”‚  Download   â”‚
  â”‚ Upload  â”‚              â”‚   Engine    â”‚           â”‚   Drafting  â”‚          â”‚  MD / PDF   â”‚
  â”‚ + ì œëª©  â”‚              â”‚             â”‚           â”‚             â”‚          â”‚             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                          â”‚                         â”‚                        â”‚
       â”‚                          â–¼                         â–¼                        â”‚
       â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
       â”‚                   â”‚ â€¢ RÂ² Score  â”‚           â”‚ â€¢ ì„œë¡  ì´ˆì•ˆ â”‚                 â”‚
       â”‚                   â”‚ â€¢ ê¸°ìš¸ê¸°    â”‚           â”‚ â€¢ ê²°ë¡  ì´ˆì•ˆ â”‚                 â”‚
       â”‚                   â”‚ â€¢ ì˜¤ì°¨ìœ¨   â”‚           â”‚ â€¢ ì˜¤ì°¨ ë¶„ì„ â”‚                 â”‚
       â”‚                   â”‚ â€¢ PNG Graph â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
       â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
       â”‚                                                                             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 30 seconds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Step-by-Step Description

#### Step 1: Upload (ì‚¬ìš©ì ì…ë ¥)
- **Actions:**
  - CSV ë˜ëŠ” Excel(.xlsx) íŒŒì¼ ì—…ë¡œë“œ
  - ì‹¤í—˜ ì œëª© ì…ë ¥ (ì˜ˆ: "RC íšŒë¡œ ì‹œì •ìˆ˜ ì¸¡ì • ì‹¤í—˜")
  - Xì¶•/Yì¶• ì—´ ì„ íƒ (Optional: ìë™ ê°ì§€)
- **Validation:**
  - íŒŒì¼ í˜•ì‹ ê²€ì¦ (CSV, XLSXë§Œ í—ˆìš©)
  - ìµœëŒ€ íŒŒì¼ í¬ê¸°: 10MB
  - ìµœì†Œ ë°ì´í„° í¬ì¸íŠ¸: 5ê°œ ì´ìƒ

#### Step 2: Analysis (ìë™ ë¶„ì„)
- **Processing:**
  - Pandasë¡œ ë°ì´í„° ë¡œë“œ ë° ê²°ì¸¡ì¹˜ ì²˜ë¦¬
  - Scipy `linregress()`ë¡œ ì„ í˜• íšŒê·€ ë¶„ì„
  - Matplotlibìœ¼ë¡œ ê³ í•´ìƒë„ ê·¸ë˜í”„ ìƒì„± (300 DPI)
- **Output:**
  - í†µê³„ ìš”ì•½: slope, intercept, RÂ², std_error
  - ê·¸ë˜í”„ ì´ë¯¸ì§€ (Base64 ë˜ëŠ” URL)
  - ì˜¤ì°¨ìœ¨ ê³„ì‚°: `|(ì¸¡ì •ê°’ - ì´ë¡ ê°’) / ì´ë¡ ê°’| Ã— 100%`

#### Step 3: Drafting (AI ì´ˆì•ˆ ìƒì„±)
- **Input to LLM:**
  - ì‹¤í—˜ ì œëª©
  - ë¶„ì„ í†µê³„ ë°ì´í„° (JSON)
  - ì‹¤í—˜ë³„ ì˜¤ì°¨ ë¶„ì„ í”„ë¦¬ì…‹ (ìˆì„ ê²½ìš°)
- **Output from LLM:**
  - ì„œë¡ (Introduction) ì´ˆì•ˆ (2-3ë¬¸ë‹¨)
  - ê³ ì°°(Discussion) ì´ˆì•ˆ (3-4ë¬¸ë‹¨, ì˜¤ì°¨ ì›ì¸ í¬í•¨)
  - ê²°ë¡ (Conclusion) ìš”ì•½

#### Step 4: Export (ê²°ê³¼ ë‹¤ìš´ë¡œë“œ)
- **Available Formats:**
  - Markdown (.md)
  - PDF (ì¶”í›„ êµ¬í˜„)
- **Includes:**
  - ê·¸ë˜í”„ ì´ë¯¸ì§€ (ì„ë² ë”©)
  - í†µê³„ í…Œì´ë¸”
  - AI ìƒì„± í…ìŠ¤íŠ¸

---

## 3. System Architecture

### 3.1 Hybrid Engine Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              SYSTEM ARCHITECTURE                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚    USER     â”‚
                                    â”‚  (Browser)  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚ HTTPS
                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FRONTEND LAYER                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         Next.js 14 (App Router)                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Upload Page  â”‚  â”‚ Results View â”‚  â”‚ Report Editorâ”‚  â”‚ History Page  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   (shadcn)   â”‚  â”‚  (Recharts)  â”‚  â”‚   (Editor)   â”‚  â”‚   (Table)     â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â”‚ REST API
                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              BACKEND LAYER (FastAPI)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                              API Gateway                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  /api/analyze   â”‚  â”‚  /api/generate  â”‚  â”‚      /api/reports           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     /data       â”‚  â”‚   /discussion   â”‚  â”‚         /{id}               â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                    â”‚                          â”‚                   â”‚
â”‚              â–¼                    â–¼                          â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PYTHON ANALYSIS  â”‚  â”‚   LLM DRAFTING    â”‚  â”‚      DATABASE SERVICE         â”‚ â”‚
â”‚  â”‚      ENGINE       â”‚  â”‚      ENGINE       â”‚  â”‚                               â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â”‚    Pandas     â”‚ â”‚  â”‚ â”‚   OpenAI API  â”‚ â”‚  â”‚  â”‚       Supabase          â”‚  â”‚ â”‚
â”‚  â”‚ â”‚   DataFrame   â”‚ â”‚  â”‚ â”‚    (GPT-4o)   â”‚ â”‚  â”‚  â”‚     (PostgreSQL)        â”‚  â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â”‚    Scipy      â”‚ â”‚  â”‚ â”‚Prompt Manager â”‚ â”‚  â”‚  â”‚    Supabase Storage     â”‚  â”‚ â”‚
â”‚  â”‚ â”‚  linregress() â”‚ â”‚  â”‚ â”‚  (Templates)  â”‚ â”‚  â”‚  â”‚   (Graph Images)        â”‚  â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                   â”‚  â”‚                               â”‚ â”‚
â”‚  â”‚ â”‚  Matplotlib   â”‚ â”‚  â”‚                   â”‚  â”‚                               â”‚ â”‚
â”‚  â”‚ â”‚  Graph Gen    â”‚ â”‚  â”‚                   â”‚  â”‚                               â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                   â”‚  â”‚                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Data Pipeline Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA PIPELINE                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[RAW DATA]        [PROCESSING]         [ANALYSIS]           [OUTPUT]
    â”‚                  â”‚                   â”‚                    â”‚
    â–¼                  â–¼                   â–¼                    â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CSV/XLS â”‚ â”€â”€â–¶  â”‚   Load &      â”‚   â”‚  Statistical  â”‚   â”‚   LLM Prompt  â”‚
â”‚  File   â”‚      â”‚   Clean Data  â”‚   â”‚   Analysis    â”‚   â”‚   Injection   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                   â”‚                    â”‚
                        â–¼                   â–¼                    â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  Pandas     â”‚     â”‚ Scipy Stats â”‚     â”‚   GPT-4o    â”‚
                 â”‚  DataFrame  â”‚     â”‚  + Graph    â”‚     â”‚   Response  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                   â”‚                    â”‚
                        â–¼                   â–¼                    â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ â€¢ NaNì²˜ë¦¬   â”‚     â”‚ â€¢ RÂ² Score  â”‚     â”‚ â€¢ ì„œë¡  ì´ˆì•ˆ â”‚
                 â”‚ â€¢ íƒ€ì…ë³€í™˜  â”‚     â”‚ â€¢ slope     â”‚     â”‚ â€¢ ê³ ì°° ì´ˆì•ˆ â”‚
                 â”‚ â€¢ ì´ìƒì¹˜ì œê±°â”‚     â”‚ â€¢ intercept â”‚     â”‚ â€¢ ì˜¤ì°¨ë¶„ì„  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â€¢ std_err   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ â€¢ PNG Graph â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ FINAL REPORT  â”‚
                                    â”‚ (MD / PDF)    â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Directory Structure

```
labreportai/
â”œâ”€â”€ frontend/                          # Next.js 14 Application
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx               # Landing / Upload Page
â”‚   â”‚   â”‚   â”œâ”€â”€ analyze/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx           # Analysis Results View
â”‚   â”‚   â”‚   â”œâ”€â”€ report/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx       # Report Detail View
â”‚   â”‚   â”‚   â””â”€â”€ history/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx           # User Report History
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                    # shadcn/ui components
â”‚   â”‚   â”‚   â”œâ”€â”€ FileUploader.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AnalysisChart.tsx      # Recharts wrapper
â”‚   â”‚   â”‚   â”œâ”€â”€ StatisticsCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ReportViewer.tsx
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts                 # API client functions
â”‚   â”‚   â”‚   â”œâ”€â”€ supabase.ts            # Supabase client
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚       â””â”€â”€ index.ts               # TypeScript interfaces
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â””â”€â”€ next.config.js
â”‚
â”œâ”€â”€ backend/                           # FastAPI Application
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py                    # FastAPI entry point
â”‚   â”‚   â”œâ”€â”€ config.py                  # Environment configuration
â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ analyze.py             # /api/analyze/* endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ generate.py            # /api/generate/* endpoints
â”‚   â”‚   â”‚   â””â”€â”€ reports.py             # /api/reports/* endpoints
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ analysis_engine.py     # Pandas/Scipy logic (CORE)
â”‚   â”‚   â”‚   â”œâ”€â”€ graph_generator.py     # Matplotlib logic
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_service.py         # OpenAI API wrapper
â”‚   â”‚   â”‚   â””â”€â”€ storage_service.py     # Supabase interaction
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ schemas.py             # Pydantic request/response models
â”‚   â”‚   â”‚   â””â”€â”€ database.py            # Database models
â”‚   â”‚   â”œâ”€â”€ prompts/                   # LLM Prompt Templates (IMPORTANT)
â”‚   â”‚   â”‚   â”œâ”€â”€ introduction.py
â”‚   â”‚   â”‚   â”œâ”€â”€ discussion.py
â”‚   â”‚   â”‚   â””â”€â”€ conclusion.py
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ file_parser.py         # CSV/Excel parsing
â”‚   â”‚       â””â”€â”€ validators.py          # Input validation
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”œâ”€â”€ test_analysis.py
â”‚   â”‚   â””â”€â”€ test_llm.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ shared/                            # Shared constants/types
â”‚   â””â”€â”€ experiment_presets/            # Admin-managed presets
â”‚       â”œâ”€â”€ rc_circuit.json
â”‚       â”œâ”€â”€ pendulum.json
â”‚       â””â”€â”€ optics.json
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â”œâ”€â”€ README.md
â””â”€â”€ CLAUDE.md                          # This file
```

---

## 4. Database Schema (Supabase)

### 4.1 Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATABASE SCHEMA                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      users        â”‚          â”‚      presets      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK, UUID)     â”‚          â”‚ id (PK, UUID)     â”‚
    â”‚ email             â”‚          â”‚ name              â”‚
    â”‚ name              â”‚          â”‚ category          â”‚
    â”‚ university        â”‚          â”‚ error_guide       â”‚
    â”‚ department        â”‚          â”‚ theory_reference  â”‚
    â”‚ credits (INT)     â”‚          â”‚ created_at        â”‚
    â”‚ created_at        â”‚          â”‚ updated_at        â”‚
    â”‚ updated_at        â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 1:N
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      reports      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK, UUID)     â”‚
    â”‚ user_id (FK)      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€ users.id
    â”‚ preset_id (FK)    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€ presets.id (nullable)
    â”‚ title             â”‚
    â”‚ original_filename â”‚
    â”‚ original_data_url â”‚
    â”‚ graph_image_url   â”‚
    â”‚ statistics (JSONB)â”‚
    â”‚ generated_text    â”‚
    â”‚ status            â”‚
    â”‚ created_at        â”‚
    â”‚ updated_at        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Table Definitions

#### 4.2.1 `users` Table

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    university VARCHAR(100),
    department VARCHAR(100),
    credits INTEGER DEFAULT 10,  -- ë¬´ë£Œ í¬ë ˆë”§ (í–¥í›„ ê³¼ê¸ˆ ì‹œìŠ¤í…œìš©)
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS Policy
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own data" ON users
    FOR SELECT USING (auth.uid() = id);
```

#### 4.2.2 `reports` Table

```sql
CREATE TABLE reports (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    preset_id UUID REFERENCES presets(id) ON DELETE SET NULL,
    title VARCHAR(255) NOT NULL,
    original_filename VARCHAR(255) NOT NULL,
    original_data_url TEXT,  -- Supabase Storage URL
    graph_image_url TEXT,    -- Generated graph URL
    statistics JSONB NOT NULL DEFAULT '{}',
    /*
    statistics ì˜ˆì‹œ:
    {
        "slope": 2.34,
        "intercept": 0.12,
        "r_squared": 0.9876,
        "std_error": 0.05,
        "error_rate": 3.2,
        "data_points": 25
    }
    */
    generated_text JSONB NOT NULL DEFAULT '{}',
    /*
    generated_text ì˜ˆì‹œ:
    {
        "introduction": "ë³¸ ì‹¤í—˜ì€...",
        "discussion": "ê·¸ë˜í”„ ë¶„ì„ ê²°ê³¼...",
        "conclusion": "ë”°ë¼ì„œ..."
    }
    */
    status VARCHAR(20) DEFAULT 'completed', -- 'processing', 'completed', 'failed'
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_reports_user_id ON reports(user_id);
CREATE INDEX idx_reports_created_at ON reports(created_at DESC);

-- RLS Policy
ALTER TABLE reports ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can CRUD own reports" ON reports
    FOR ALL USING (auth.uid() = user_id);
```

#### 4.2.3 `presets` Table

```sql
CREATE TABLE presets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,           -- "RC íšŒë¡œ ì‹¤í—˜"
    category VARCHAR(50) NOT NULL,        -- "ì „ìê¸°í•™", "ì—­í•™", "ê´‘í•™"
    error_guide JSONB NOT NULL DEFAULT '[]',
    /*
    error_guide ì˜ˆì‹œ:
    [
        {
            "cause": "ì ‘ì´‰ ì €í•­",
            "description": "íšŒë¡œ ì—°ê²°ë¶€ì˜ ì ‘ì´‰ ë¶ˆëŸ‰ìœ¼ë¡œ ì¸í•œ ì €í•­ ì¦ê°€",
            "mitigation": "ì—°ê²°ë¶€ ì¬í™•ì¸ ë° ì ‘ì  ì²­ì†Œ"
        },
        {
            "cause": "ì¸¡ì • ê¸°ê¸° ì˜¤ì°¨",
            "description": "ë©€í‹°ë¯¸í„°ì˜ ë‚´ë¶€ ì €í•­ìœ¼ë¡œ ì¸í•œ ì¸¡ì •ê°’ ì™œê³¡",
            "mitigation": "ê³ ì…ë ¥ ì„í”¼ë˜ìŠ¤ ì¸¡ì •ê¸° ì‚¬ìš©"
        }
    ]
    */
    theory_reference TEXT,                -- "Ï„ = RC, ì‹œì •ìˆ˜ ì •ì˜..."
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Admin only access
ALTER TABLE presets ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Presets are read-only for authenticated users" ON presets
    FOR SELECT USING (auth.role() = 'authenticated');
```

---

## 5. API Endpoints Specification (FastAPI)

### 5.1 Endpoint Overview

| Method | Endpoint | Description | Auth Required |
|--------|----------|-------------|---------------|
| POST | `/api/analyze/data` | íŒŒì¼ ì—…ë¡œë“œ ë° í†µê³„ ë¶„ì„ | Yes |
| POST | `/api/generate/discussion` | AI ê³ ì°° í…ìŠ¤íŠ¸ ìƒì„± | Yes |
| GET | `/api/reports` | ì‚¬ìš©ì ë¦¬í¬íŠ¸ ëª©ë¡ ì¡°íšŒ | Yes |
| GET | `/api/reports/{id}` | ë¦¬í¬íŠ¸ ìƒì„¸ ì¡°íšŒ | Yes |
| DELETE | `/api/reports/{id}` | ë¦¬í¬íŠ¸ ì‚­ì œ | Yes |
| GET | `/api/presets` | ì‹¤í—˜ í”„ë¦¬ì…‹ ëª©ë¡ ì¡°íšŒ | Yes |

### 5.2 Endpoint Details

#### 5.2.1 `POST /api/analyze/data`

ë°ì´í„° íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ í†µê³„ ë¶„ì„ ê²°ê³¼ì™€ ê·¸ë˜í”„ ì´ë¯¸ì§€ë¥¼ ë°˜í™˜í•œë‹¤.

**Request:**
```http
POST /api/analyze/data
Content-Type: multipart/form-data
Authorization: Bearer <jwt_token>

--boundary
Content-Disposition: form-data; name="file"; filename="experiment_data.csv"
Content-Type: text/csv

time,voltage
0.1,1.2
0.2,2.1
...
--boundary
Content-Disposition: form-data; name="title"

RC íšŒë¡œ ì‹œì •ìˆ˜ ì¸¡ì • ì‹¤í—˜
--boundary
Content-Disposition: form-data; name="x_column"

time
--boundary
Content-Disposition: form-data; name="y_column"

voltage
--boundary
Content-Disposition: form-data; name="preset_id" (optional)

550e8400-e29b-41d4-a716-446655440000
--boundary--
```

**Response (200 OK):**
```json
{
    "success": true,
    "data": {
        "analysis_id": "7f3d2a1e-4b5c-6d7e-8f9a-0b1c2d3e4f5a",
        "statistics": {
            "slope": 2.3456,
            "intercept": 0.1234,
            "r_squared": 0.9876,
            "std_error": 0.0521,
            "error_rate_percent": 3.21,
            "data_points": 25,
            "x_range": [0.1, 5.0],
            "y_range": [1.2, 12.5]
        },
        "graph": {
            "image_base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
            "image_url": "https://xyz.supabase.co/storage/v1/graphs/abc123.png"
        },
        "data_summary": {
            "columns": ["time", "voltage"],
            "row_count": 25,
            "null_values_removed": 2
        }
    },
    "message": "ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

**Error Response (400 Bad Request):**
```json
{
    "success": false,
    "error": {
        "code": "INVALID_FILE_FORMAT",
        "message": "ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. CSV ë˜ëŠ” Excel íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”."
    }
}
```

#### 5.2.2 `POST /api/generate/discussion`

ë¶„ì„ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ AIê°€ ê³ ì°° í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•œë‹¤.

**Request:**
```json
{
    "analysis_id": "7f3d2a1e-4b5c-6d7e-8f9a-0b1c2d3e4f5a",
    "title": "RC íšŒë¡œ ì‹œì •ìˆ˜ ì¸¡ì • ì‹¤í—˜",
    "statistics": {
        "slope": 2.3456,
        "intercept": 0.1234,
        "r_squared": 0.9876,
        "std_error": 0.0521,
        "error_rate_percent": 3.21
    },
    "preset_id": "550e8400-e29b-41d4-a716-446655440000",
    "sections": ["introduction", "discussion", "conclusion"],
    "options": {
        "language": "ko",
        "tone": "academic",
        "include_error_analysis": true
    }
}
```

**Response (200 OK):**
```json
{
    "success": true,
    "data": {
        "report_id": "8a9b0c1d-2e3f-4a5b-6c7d-8e9f0a1b2c3d",
        "generated_text": {
            "introduction": "ë³¸ ì‹¤í—˜ì€ RC íšŒë¡œì˜ ì‹œì •ìˆ˜(Ï„)ë¥¼ ì¸¡ì •í•˜ê³ , ì´ë¡ ì  ì˜ˆì¸¡ê°’ê³¼ ë¹„êµ ë¶„ì„í•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•œë‹¤. RC íšŒë¡œì—ì„œ ì‹œì •ìˆ˜ëŠ” Ï„ = RCë¡œ ì •ì˜ë˜ë©°, ì´ëŠ” ì»¤íŒ¨ì‹œí„°ê°€ ìµœëŒ€ ì „ì••ì˜ ì•½ 63.2%ê¹Œì§€ ì¶©ì „ë˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ì˜ë¯¸í•œë‹¤.",
            "discussion": "ì‹¤í—˜ ê²°ê³¼ ë¶„ì„ì— ë”°ë¥´ë©´, ì¸¡ì •ëœ ë°ì´í„°ì˜ ê²°ì •ê³„ìˆ˜(RÂ²)ê°€ 0.9876ìœ¼ë¡œ ë†’ì€ ì„ í˜•ì„±ì„ ë³´ì˜€ë‹¤. ì´ëŠ” ì‹¤í—˜ ë°ì´í„°ê°€ ì´ë¡ ì  ëª¨ë¸ê³¼ ì˜ ì¼ì¹˜í•¨ì„ ë‚˜íƒ€ë‚¸ë‹¤.\n\nê·¸ëŸ¬ë‚˜ ì•½ 3.21%ì˜ ì˜¤ì°¨ìœ¨ì´ ê´€ì°°ë˜ì—ˆìœ¼ë©°, ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìš”ì¸ì— ê¸°ì¸í•  ìˆ˜ ìˆë‹¤:\n\n1. **ì ‘ì´‰ ì €í•­**: íšŒë¡œ ì—°ê²°ë¶€ì˜ ì ‘ì´‰ ë¶ˆëŸ‰ìœ¼ë¡œ ì¸í•œ ì €í•­ ì¦ê°€ê°€ ì‹œì •ìˆ˜ ì¸¡ì •ì— ì˜í–¥ì„ ë¯¸ì³¤ì„ ê°€ëŠ¥ì„±ì´ ìˆë‹¤.\n\n2. **ì¸¡ì • ê¸°ê¸°ì˜ ë‚´ë¶€ ì €í•­**: ë©€í‹°ë¯¸í„°ì˜ ìœ í•œí•œ ì…ë ¥ ì„í”¼ë˜ìŠ¤ê°€ íšŒë¡œì˜ ë“±ê°€ ì €í•­ì„ ë³€í™”ì‹œì¼œ ì¸¡ì •ê°’ì— ì˜¤ì°¨ë¥¼ ìœ ë°œí–ˆì„ ìˆ˜ ìˆë‹¤.\n\n3. **ì»¤íŒ¨ì‹œí„°ì˜ ë¹„ì´ìƒì  íŠ¹ì„±**: ì‹¤ì œ ì»¤íŒ¨ì‹œí„°ëŠ” ë“±ê°€ ì§ë ¬ ì €í•­(ESR)ì„ ê°€ì§€ë©°, ì´ë¡œ ì¸í•´ ì´ìƒì ì¸ RC ì‹œì •ìˆ˜ì™€ í¸ì°¨ê°€ ë°œìƒí•œë‹¤.",
            "conclusion": "ë³¸ ì‹¤í—˜ì„ í†µí•´ RC íšŒë¡œì˜ ì‹œì •ìˆ˜ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì¸¡ì •í•˜ì˜€ìœ¼ë©°, ì´ë¡ ê°’ê³¼ì˜ ì˜¤ì°¨ëŠ” í—ˆìš© ë²”ìœ„ ë‚´ì— ìˆìŒì„ í™•ì¸í•˜ì˜€ë‹¤. í–¥í›„ ì‹¤í—˜ì—ì„œëŠ” ê³ ì •ë°€ ì¸¡ì • ì¥ë¹„ë¥¼ ì‚¬ìš©í•˜ê³  ì ‘ì  ìƒíƒœë¥¼ ê°œì„ í•˜ì—¬ ì˜¤ì°¨ë¥¼ ìµœì†Œí™”í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤."
        },
        "tokens_used": 847,
        "model": "gpt-4o"
    },
    "message": "ë¦¬í¬íŠ¸ ì´ˆì•ˆì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

#### 5.2.3 `GET /api/reports/{id}`

ì €ì¥ëœ ë¦¬í¬íŠ¸ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•œë‹¤.

**Request:**
```http
GET /api/reports/8a9b0c1d-2e3f-4a5b-6c7d-8e9f0a1b2c3d
Authorization: Bearer <jwt_token>
```

**Response (200 OK):**
```json
{
    "success": true,
    "data": {
        "id": "8a9b0c1d-2e3f-4a5b-6c7d-8e9f0a1b2c3d",
        "title": "RC íšŒë¡œ ì‹œì •ìˆ˜ ì¸¡ì • ì‹¤í—˜",
        "status": "completed",
        "original_filename": "experiment_data.csv",
        "graph_image_url": "https://xyz.supabase.co/storage/v1/graphs/abc123.png",
        "statistics": {
            "slope": 2.3456,
            "intercept": 0.1234,
            "r_squared": 0.9876,
            "std_error": 0.0521,
            "error_rate_percent": 3.21,
            "data_points": 25
        },
        "generated_text": {
            "introduction": "ë³¸ ì‹¤í—˜ì€...",
            "discussion": "ì‹¤í—˜ ê²°ê³¼ ë¶„ì„ì— ë”°ë¥´ë©´...",
            "conclusion": "ë³¸ ì‹¤í—˜ì„ í†µí•´..."
        },
        "preset": {
            "id": "550e8400-e29b-41d4-a716-446655440000",
            "name": "RC íšŒë¡œ ì‹¤í—˜",
            "category": "ì „ìê¸°í•™"
        },
        "created_at": "2026-01-30T10:30:00Z",
        "updated_at": "2026-01-30T10:30:45Z"
    }
}
```

**Error Response (404 Not Found):**
```json
{
    "success": false,
    "error": {
        "code": "REPORT_NOT_FOUND",
        "message": "í•´ë‹¹ ë¦¬í¬íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    }
}
```

---

## 6. Development Roadmap (Phase 1)

### 6.1 Phase Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PHASE 1 DEVELOPMENT ROADMAP                             â”‚
â”‚                              (MVP - 4 Weeks)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Week 1                 Week 2                 Week 3                 Week 4
  â”‚                      â”‚                      â”‚                      â”‚
  â–¼                      â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1  â”‚   â”€â”€â–¶    â”‚  STEP 2  â”‚   â”€â”€â–¶    â”‚  STEP 3  â”‚   â”€â”€â–¶    â”‚  STEP 4  â”‚
â”‚ FastAPI  â”‚          â”‚ Next.js  â”‚          â”‚ GPT-4o   â”‚          â”‚ Deploy   â”‚
â”‚ + Python â”‚          â”‚ Frontend â”‚          â”‚ ì—°ë™     â”‚          â”‚ + DB     â”‚
â”‚ Analysis â”‚          â”‚   UI     â”‚          â”‚          â”‚          â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â–¼                     â–¼                     â–¼                     â–¼
 â€¢ Pandas              â€¢ File Upload         â€¢ Prompt Design       â€¢ Supabase Setup
 â€¢ Scipy               â€¢ Result View         â€¢ API Integration     â€¢ Deploy (Vercel)
 â€¢ Matplotlib          â€¢ shadcn/ui           â€¢ Text Generation     â€¢ CI/CD
 â€¢ FastAPI             â€¢ Recharts            â€¢ Error Handling      â€¢ Monitoring
```

### 6.2 Step-by-Step Implementation

#### **Step 1: FastAPI + Python Analysis Engine (Week 1)**

**ëª©í‘œ:** í•µì‹¬ ë°ì´í„° ë¶„ì„ ì—”ì§„ êµ¬í˜„

**Tasks:**
- [ ] FastAPI í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •
- [ ] CSV/Excel íŒŒì¼ íŒŒì„œ êµ¬í˜„ (`services/analysis_engine.py`)
- [ ] Pandas DataFrame ì „ì²˜ë¦¬ ë¡œì§ êµ¬í˜„
  - ê²°ì¸¡ì¹˜(NaN) ì²˜ë¦¬
  - ë°ì´í„° íƒ€ì… ìë™ ë³€í™˜
  - ì´ìƒì¹˜ ê°ì§€ (Optional)
- [ ] Scipy `linregress()` í†µê³„ ë¶„ì„ êµ¬í˜„
  - slope, intercept, r_value, p_value, std_err ê³„ì‚°
  - ì˜¤ì°¨ìœ¨ ê³„ì‚° í•¨ìˆ˜
- [ ] Matplotlib ê·¸ë˜í”„ ìƒì„± (`services/graph_generator.py`)
  - ì‚°ì ë„ + ì¶”ì„¸ì„  ê·¸ë˜í”„
  - 300 DPI ê³ í•´ìƒë„ ì¶œë ¥
  - Base64 ì¸ì½”ë”© ë°˜í™˜
- [ ] `/api/analyze/data` ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±

**Deliverables:**
- íŒŒì¼ ì—…ë¡œë“œ â†’ í†µê³„ ë¶„ì„ â†’ ê·¸ë˜í”„ ë°˜í™˜ API ë™ì‘ í™•ì¸
- Postman/curl í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

#### **Step 2: Next.js Frontend UI (Week 2)**

**ëª©í‘œ:** íŒŒì¼ ì—…ë¡œë“œ UI ë° ê²°ê³¼ ë·°ì–´ êµ¬í˜„

**Tasks:**
- [ ] Next.js 14 í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì • (App Router)
- [ ] Tailwind CSS + shadcn/ui ì„¤ì¹˜ ë° êµ¬ì„±
- [ ] ë©”ì¸ ì—…ë¡œë“œ í˜ì´ì§€ êµ¬í˜„ (`app/page.tsx`)
  - Drag & Drop íŒŒì¼ ì—…ë¡œë“œ (shadcn `Input` + custom)
  - ì‹¤í—˜ ì œëª© ì…ë ¥ í•„ë“œ
  - Xì¶•/Yì¶• ì—´ ì„ íƒ ë“œë¡­ë‹¤ìš´
  - ë¶„ì„ ì‹œì‘ ë²„íŠ¼
- [ ] ë¶„ì„ ê²°ê³¼ í˜ì´ì§€ êµ¬í˜„ (`app/analyze/page.tsx`)
  - ê·¸ë˜í”„ ì´ë¯¸ì§€ í‘œì‹œ
  - í†µê³„ ë°ì´í„° ì¹´ë“œ (RÂ², slope, error_rate ë“±)
  - Recharts ì¸í„°ë™í‹°ë¸Œ ì°¨íŠ¸ (Optional)
- [ ] API í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜ êµ¬í˜„ (`lib/api.ts`)
- [ ] ë¡œë”© ìƒíƒœ ë° ì—ëŸ¬ í•¸ë“¤ë§ UI
- [ ] ë°˜ì‘í˜• ë””ìì¸ ì ìš©

**Deliverables:**
- íŒŒì¼ ì—…ë¡œë“œ â†’ ë¶„ì„ ê²°ê³¼ í‘œì‹œ E2E í”Œë¡œìš° ì™„ì„±
- ëª¨ë°”ì¼ ë°˜ì‘í˜• í™•ì¸

---

#### **Step 3: GPT-4o Integration (Week 3)**

**ëª©í‘œ:** AI ê¸°ë°˜ í…ìŠ¤íŠ¸ ìƒì„± ì‹œìŠ¤í…œ êµ¬í˜„

**Tasks:**
- [ ] OpenAI API í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (`services/llm_service.py`)
- [ ] í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì„¤ê³„ (`prompts/` ë””ë ‰í† ë¦¬)
  - `introduction.py`: ì„œë¡  ìƒì„± í”„ë¡¬í”„íŠ¸
  - `discussion.py`: ê³ ì°° + ì˜¤ì°¨ ë¶„ì„ í”„ë¡¬í”„íŠ¸
  - `conclusion.py`: ê²°ë¡  ìƒì„± í”„ë¡¬í”„íŠ¸
- [ ] í”„ë¡¬í”„íŠ¸ì— ì£¼ì…í•  ë³€ìˆ˜ ì •ì˜
  - ì‹¤í—˜ ì œëª©
  - í†µê³„ ë°ì´í„° (JSON)
  - ì˜¤ì°¨ ë¶„ì„ ê°€ì´ë“œ (preset ê¸°ë°˜)
- [ ] `/api/generate/discussion` ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- [ ] ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„ (Optional, SSE)
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™
  - ìƒì„±ëœ í…ìŠ¤íŠ¸ í‘œì‹œ
  - ë³µì‚¬ ë° í¸ì§‘ ê¸°ëŠ¥
- [ ] í† í° ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

**Deliverables:**
- ë¶„ì„ ê²°ê³¼ â†’ AI ê³ ì°° ìƒì„± â†’ í…ìŠ¤íŠ¸ í‘œì‹œ í”Œë¡œìš° ì™„ì„±
- í”„ë¡¬í”„íŠ¸ í’ˆì§ˆ í…ŒìŠ¤íŠ¸ (3ê°œ ì´ìƒ ì‹¤í—˜ ë°ì´í„°ë¡œ ê²€ì¦)

---

#### **Step 4: Supabase Integration & Deployment (Week 4)**

**ëª©í‘œ:** ë°ì´í„° ì˜ì†ì„± ë° í”„ë¡œë•ì…˜ ë°°í¬

**Tasks:**
- [ ] Supabase í”„ë¡œì íŠ¸ ì„¤ì •
  - PostgreSQL í…Œì´ë¸” ìƒì„± (users, reports, presets)
  - RLS ì •ì±… ì„¤ì •
  - Storage ë²„í‚· ìƒì„± (graphs, raw_data)
- [ ] Supabase Auth ì—°ë™
  - ì´ë©”ì¼/ì†Œì…œ ë¡œê·¸ì¸ êµ¬í˜„
  - ì„¸ì…˜ ê´€ë¦¬
- [ ] ë°±ì—”ë“œ Supabase ì—°ë™ (`services/storage_service.py`)
  - ë¦¬í¬íŠ¸ ì €ì¥/ì¡°íšŒ API êµ¬í˜„
  - ê·¸ë˜í”„ ì´ë¯¸ì§€ Storage ì—…ë¡œë“œ
- [ ] í”„ë¡ íŠ¸ì—”ë“œ Supabase ì—°ë™
  - ë¡œê·¸ì¸/íšŒì›ê°€ì… UI
  - ë¦¬í¬íŠ¸ íˆìŠ¤í† ë¦¬ í˜ì´ì§€
- [ ] ë°°í¬ ì„¤ì •
  - Frontend: Vercel ë°°í¬
  - Backend: Railway / Render ë°°í¬
  - í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- [ ] CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì„± (GitHub Actions)
- [ ] ê¸°ë³¸ ëª¨ë‹ˆí„°ë§ ì„¤ì •

**Deliverables:**
- í”„ë¡œë•ì…˜ URL ë°°í¬ ì™„ë£Œ
- ì‚¬ìš©ì ì¸ì¦ ë° ë°ì´í„° ì €ì¥ ë™ì‘ í™•ì¸

---

## 7. Implementation Rules for Claude Code

### 7.1 ì½”ë“œ êµ¬ì¡° ì›ì¹™

> **RULE 1:** ë°ì´í„° ë¶„ì„ ë¡œì§(Python)ê³¼ ì›¹ ì„œë¹„ìŠ¤ ë¡œì§(API)ì„ ëª…í™•íˆ ë¶„ë¦¬í•  ê²ƒ.

```python
# âŒ BAD: ë¼ìš°í„°ì—ì„œ ì§ì ‘ ë¶„ì„ ë¡œì§ êµ¬í˜„
@router.post("/analyze/data")
async def analyze_data(file: UploadFile):
    df = pd.read_csv(file.file)  # ë¼ìš°í„°ì—ì„œ ì§ì ‘ Pandas í˜¸ì¶œ
    slope, intercept, r, p, se = linregress(df['x'], df['y'])
    # ...

# âœ… GOOD: ì„œë¹„ìŠ¤ ë ˆì´ì–´ë¡œ ë¶„ë¦¬
# routers/analyze.py
@router.post("/analyze/data")
async def analyze_data(file: UploadFile, service: AnalysisService = Depends()):
    result = await service.analyze_file(file)
    return AnalysisResponse(**result)

# services/analysis_engine.py
class AnalysisService:
    async def analyze_file(self, file: UploadFile) -> dict:
        df = await self._load_dataframe(file)
        stats = self._calculate_statistics(df)
        graph = await self._generate_graph(df, stats)
        return {"statistics": stats, "graph": graph}
```

---

> **RULE 2:** LLM í”„ë¡¬í”„íŠ¸ëŠ” í•˜ë“œì½”ë”©í•˜ì§€ ë§ê³  ë³„ë„ íŒŒì¼ë¡œ ê´€ë¦¬í•  ê²ƒ.

```python
# âŒ BAD: í”„ë¡¬í”„íŠ¸ í•˜ë“œì½”ë”©
async def generate_discussion(data: dict):
    prompt = f"ë‹¹ì‹ ì€ ë¬¼ë¦¬í•™ êµìˆ˜ì…ë‹ˆë‹¤. ë‹¤ìŒ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì„¸ìš”: {data}"
    response = await openai.chat.completions.create(...)

# âœ… GOOD: í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë¶„ë¦¬
# prompts/discussion.py
DISCUSSION_PROMPT_TEMPLATE = """
ë‹¹ì‹ ì€ ì´ê³µê³„ ì‹¤í—˜ ë¦¬í¬íŠ¸ ì‘ì„±ì„ ë„ì™€ì£¼ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

## ì—­í• 
- ì‹¤í—˜ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  í•™ìˆ ì  ì–´ì¡°ì˜ ê³ ì°°(Discussion)ì„ ì‘ì„±í•©ë‹ˆë‹¤.
- ì˜¤ì°¨ ì›ì¸ì„ ê³¼í•™ì ìœ¼ë¡œ ë¶„ì„í•˜ê³  ê°œì„  ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤.

## ì…ë ¥ ë°ì´í„°
- ì‹¤í—˜ ì œëª©: {title}
- í†µê³„ ë¶„ì„ ê²°ê³¼:
  - ê¸°ìš¸ê¸° (slope): {slope}
  - ì ˆí¸ (intercept): {intercept}
  - ê²°ì •ê³„ìˆ˜ (RÂ²): {r_squared}
  - ì˜¤ì°¨ìœ¨: {error_rate}%

## ì˜¤ì°¨ ë¶„ì„ ê°€ì´ë“œ (ì‹¤í—˜ë³„ í”„ë¦¬ì…‹)
{error_guide}

## ì¶œë ¥ í˜•ì‹
3-4 ë¬¸ë‹¨ì˜ ê³ ì°° í…ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”. ê° ë¬¸ë‹¨ì€ ë‹¤ìŒì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:
1. ë°ì´í„° ê²½í–¥ì„± ë¶„ì„
2. ì´ë¡ ê°’ê³¼ì˜ ë¹„êµ
3. ì˜¤ì°¨ ì›ì¸ ë¶„ì„ (ìµœì†Œ 2ê°€ì§€)
4. ê°œì„  ë°©ì•ˆ ì œì•ˆ
"""

def build_discussion_prompt(title: str, stats: dict, error_guide: list) -> str:
    return DISCUSSION_PROMPT_TEMPLATE.format(
        title=title,
        slope=stats["slope"],
        intercept=stats["intercept"],
        r_squared=stats["r_squared"],
        error_rate=stats["error_rate_percent"],
        error_guide=format_error_guide(error_guide)
    )
```

---

> **RULE 3:** íƒ€ì… íŒíŠ¸(Type Hint)ì™€ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ì—„ê²©í•˜ê²Œ í•  ê²ƒ.

```python
# âŒ BAD: íƒ€ì… íŒíŠ¸ ì—†ìŒ, ì—ëŸ¬ ì²˜ë¦¬ ì—†ìŒ
def analyze_data(file):
    df = pd.read_csv(file)
    return {"slope": df['x'].mean()}

# âœ… GOOD: íƒ€ì… íŒíŠ¸ + ì»¤ìŠ¤í…€ ì˜ˆì™¸ + ìƒì„¸ ì—ëŸ¬ ì²˜ë¦¬
from typing import Optional
from pydantic import BaseModel
from fastapi import HTTPException, status

class AnalysisResult(BaseModel):
    slope: float
    intercept: float
    r_squared: float
    std_error: float
    error_rate_percent: float
    data_points: int

class AnalysisError(Exception):
    """ë¶„ì„ ê´€ë ¨ ì»¤ìŠ¤í…€ ì˜ˆì™¸"""
    def __init__(self, code: str, message: str):
        self.code = code
        self.message = message

async def analyze_data(
    file: UploadFile,
    x_column: str,
    y_column: str,
    preset_id: Optional[str] = None
) -> AnalysisResult:
    """
    CSV/Excel íŒŒì¼ì„ ë¶„ì„í•˜ì—¬ í†µê³„ ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    
    Args:
        file: ì—…ë¡œë“œëœ íŒŒì¼
        x_column: Xì¶• ì—´ ì´ë¦„
        y_column: Yì¶• ì—´ ì´ë¦„
        preset_id: ì‹¤í—˜ í”„ë¦¬ì…‹ ID (ì„ íƒ)
    
    Returns:
        AnalysisResult: í†µê³„ ë¶„ì„ ê²°ê³¼
        
    Raises:
        AnalysisError: ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ì‹œ
    """
    try:
        df = await _load_dataframe(file)
    except Exception as e:
        raise AnalysisError(
            code="FILE_PARSE_ERROR",
            message=f"íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {str(e)}"
        )
    
    if x_column not in df.columns:
        raise AnalysisError(
            code="COLUMN_NOT_FOUND",
            message=f"'{x_column}' ì—´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‚¬ìš© ê°€ëŠ¥í•œ ì—´: {list(df.columns)}"
        )
    
    if len(df) < 5:
        raise AnalysisError(
            code="INSUFFICIENT_DATA",
            message=f"ìµœì†Œ 5ê°œ ì´ìƒì˜ ë°ì´í„° í¬ì¸íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤. í˜„ì¬: {len(df)}ê°œ"
        )
    
    # ... ë¶„ì„ ë¡œì§
    return AnalysisResult(**result)
```

---

### 7.2 í”„ë¡ íŠ¸ì—”ë“œ ê·œì¹™

```typescript
// âœ… TypeScript ì¸í„°í˜ì´ìŠ¤ ì—„ê²©í•˜ê²Œ ì •ì˜
// types/index.ts

export interface AnalysisStatistics {
  slope: number;
  intercept: number;
  r_squared: number;
  std_error: number;
  error_rate_percent: number;
  data_points: number;
  x_range: [number, number];
  y_range: [number, number];
}

export interface AnalysisResult {
  success: boolean;
  data: {
    analysis_id: string;
    statistics: AnalysisStatistics;
    graph: {
      image_base64: string;
      image_url: string;
    };
  };
  message: string;
}

export interface ApiError {
  success: false;
  error: {
    code: string;
    message: string;
  };
}

// âœ… API í•¨ìˆ˜ì— íƒ€ì… ì ìš©
// lib/api.ts
export async function analyzeData(
  file: File,
  title: string,
  xColumn: string,
  yColumn: string
): Promise<AnalysisResult> {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('title', title);
  formData.append('x_column', xColumn);
  formData.append('y_column', yColumn);
  
  const response = await fetch('/api/analyze/data', {
    method: 'POST',
    body: formData,
  });
  
  if (!response.ok) {
    const error: ApiError = await response.json();
    throw new Error(error.error.message);
  }
  
  return response.json();
}
```

---

### 7.3 í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

```bash
# .env.example

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# OpenAI
OPENAI_API_KEY=sk-...

# FastAPI
BACKEND_URL=http://localhost:8000
CORS_ORIGINS=http://localhost:3000

# Environment
NODE_ENV=development
PYTHON_ENV=development
```

---

### 7.4 í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­

```python
# tests/test_analysis.py

import pytest
from app.services.analysis_engine import AnalysisService

@pytest.fixture
def sample_csv_content():
    return """time,voltage
0.1,1.2
0.2,2.1
0.3,3.0
0.4,4.1
0.5,5.0
"""

@pytest.mark.asyncio
async def test_linear_regression_accuracy(sample_csv_content):
    """ì„ í˜• íšŒê·€ ë¶„ì„ì˜ ì •í™•ì„± í…ŒìŠ¤íŠ¸"""
    service = AnalysisService()
    result = await service.analyze_csv_content(
        content=sample_csv_content,
        x_column="time",
        y_column="voltage"
    )
    
    assert result.r_squared > 0.95, "RÂ² ê°’ì´ 0.95 ì´ìƒì´ì–´ì•¼ í•¨"
    assert 9.0 < result.slope < 11.0, "ê¸°ìš¸ê¸°ê°€ ì•½ 10ì´ì–´ì•¼ í•¨"

@pytest.mark.asyncio
async def test_error_on_insufficient_data():
    """ë°ì´í„° ë¶€ì¡± ì‹œ ì—ëŸ¬ ë°œìƒ í…ŒìŠ¤íŠ¸"""
    service = AnalysisService()
    
    with pytest.raises(AnalysisError) as exc_info:
        await service.analyze_csv_content(
            content="x,y\n1,2\n3,4",  # 2ê°œ í¬ì¸íŠ¸ë§Œ
            x_column="x",
            y_column="y"
        )
    
    assert exc_info.value.code == "INSUFFICIENT_DATA"
```

---

## 8. Quick Reference

### 8.1 í•µì‹¬ ëª…ë ¹ì–´

```bash
# Backend (FastAPI)
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload --port 8000

# Frontend (Next.js)
cd frontend
npm install
npm run dev

# í…ŒìŠ¤íŠ¸
cd backend && pytest -v
cd frontend && npm run test
```

### 8.2 í•µì‹¬ íŒŒì¼ ìš°ì„ ìˆœìœ„

ê°œë°œ ì‹œì‘ ì‹œ ë‹¤ìŒ ìˆœì„œë¡œ íŒŒì¼ì„ ìƒì„±/ìˆ˜ì •:

1. `backend/app/services/analysis_engine.py` - **ìµœìš°ì„ , í•µì‹¬ ë¶„ì„ ë¡œì§**
2. `backend/app/services/graph_generator.py` - ê·¸ë˜í”„ ìƒì„±
3. `backend/app/routers/analyze.py` - ë¶„ì„ API ì—”ë“œí¬ì¸íŠ¸
4. `frontend/src/components/FileUploader.tsx` - íŒŒì¼ ì—…ë¡œë“œ UI
5. `frontend/src/app/analyze/page.tsx` - ê²°ê³¼ í‘œì‹œ í˜ì´ì§€
6. `backend/app/prompts/discussion.py` - LLM í”„ë¡¬í”„íŠ¸
7. `backend/app/services/llm_service.py` - OpenAI ì—°ë™

---

**END OF CLAUDE.md**
