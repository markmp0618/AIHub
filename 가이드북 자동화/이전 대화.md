# 이전 대화 기록

> 새 대화를 시작할 때 이 파일을 읽어서 이전 작업 내용을 파악하세요.
> 대화가 끝나기 전에 "이전 대화.md 업데이트해줘"라고 요청하세요.

---

## 대화 1: n8n 워크플로우 구축 (2026-01-29)

### 진행한 작업

1. **MCP 연결 설정**
   - `.mcp.json` 파일에 ngrok URL 업데이트
   - `https://semiformal-uncaptiously-lyman.ngrok-free.dev`
   - Claude Code 재시작 후 n8n 연결 성공

2. **가이드북 자동 생성 워크플로우 배포**
   - Workflow ID: `Kc9oe88ZBXgf4CzM`
   - 노드 13개 구성
   - Google Gemini Chat Model 사용 (사용자가 변경)

3. **워크플로우 구조**
   ```
   Manual Trigger / Webhook
        ↓
   Set Input (topic, category, sessionId)
        ↓
   AI Agent ← Google Gemini + Simple Memory
        ↓
   Parse JSON → Validate Quality → If Valid
        ↓                              ↓
   Format for DB              Respond Error
        ↓
   Supabase Insert
        ↓
   Respond Success
   ```

4. **품질 검증 기준**
   - Step 개수: 6-12개 (에러)
   - copy_block: 최소 3개 (에러)
   - branch: 최소 2개 (에러)
   - prompt_pack: 최소 4개 (에러)
   - references: 최소 8개 (경고)

5. **가이드북-자동화-계획.md 업데이트**
   - v2 → v3로 버전 업
   - Phase 2 완료 표시
   - 배포된 워크플로우 정보 추가

### 남은 작업 (다음 대화에서)

- [ ] n8n UI에서 Credentials 설정
  - Google Gemini API
  - Supabase API
- [ ] `guides` 테이블 스키마 확인
- [ ] 워크플로우 테스트 실행
- [ ] E2E 테스트

### 주요 파일

| 파일 | 역할 |
|------|------|
| `가이드북-자동화-계획.md` | 전체 프로젝트 계획 및 진행 상황 |
| `.mcp.json` | n8n MCP 연결 설정 |
| `workflows/guidebook_generator_workflow.json` | 워크플로우 JSON (로컬 백업) |

### 참고 사항

- n8n 서버는 다른 컴퓨터에서 Docker로 실행 중
- ngrok으로 외부 접속 가능하게 설정됨
- ngrok URL은 재시작 시 변경될 수 있음

---

## 대화 2: 워크플로우 재설계 (2026-01-29)

### 진행한 작업

1. **문제점 분석**
   - Set Input 노드에서 topic/category 하드코딩 문제
   - 생성된 스킬들이 워크플로우에서 미사용
   - 잘못된 타겟: "AIHub 데이터셋 활용" 같은 개발자용 가이드 생성됨

2. **프롬프트 수정**
   - `topic_selector.md`: 타겟 → "AI 배우고 싶은 모든 사람", 금지 주제 추가
   - `guidebook_generator.md`: 타겟 변경, AIHub 팀용 가이드 금지

3. **n8n 워크플로우 재구성**
   - **워크플로우 1: 주제 선정** (`XUlYV4s081gfhpYA`) - 새로 생성
     - 카테고리 입력 → AI Agent → Top 5 주제 반환
   - **워크플로우 2: 가이드북 생성** (`Kc9oe88ZBXgf4CzM`) - 수정
     - Set Input 동적화 (topic 필수)
     - AI Agent 프롬프트 업데이트

4. **autofix 적용**
   - expression format 수정 (= prefix 추가)
   - typeVersion 업그레이드 (Webhook v2.1, If v2.3)

### 남은 작업 (다음 대화에서)

- [ ] n8n UI에서 Credentials 설정
  - Google Gemini API
  - Supabase API
- [ ] 워크플로우 테스트 실행
- [ ] E2E 테스트

### 주요 변경 파일

| 파일 | 변경 내용 |
|------|---------|
| `prompts/topic_selector.md` | 타겟 변경, 금지 주제 추가 |
| `prompts/guidebook_generator.md` | 타겟 변경, 금지 주제 추가 |
| `가이드북-자동화-계획.md` | v4로 업데이트 |
| `mcp_config.json` (Antigravity) | ngrok URL로 변경 |

### 참고 사항

- 옵션 B 선택: 분리된 2개 워크플로우
- 기존 워크플로우 수정 방식으로 진행

---

## 대화 템플릿 (복사해서 사용)

```markdown
## 대화 N: [제목] (날짜)

### 진행한 작업
-

### 남은 작업
- [ ]

### 주요 변경 파일
-

### 참고 사항
-
```
