# AIHub 가이드북 자동화 워크플로우 계획 (v4)

> 마지막 업데이트: 2026-01-29 16:35

## 프로젝트 개요

**목표**: 가이드북 주제 선정부터 웹 배포까지 전체 과정을 자동화

**현재 수동 워크플로우**:
1. 퍼플렉시티 "AIHub 주제 선정" → 주제 찾기
2. 퍼플렉시티 "AIHub 가이드북 생성기" → 가이드북 작성
3. 개발자에게 전달 → antigravity에서 코드베이스에 추가
4. Supabase SQL Editor → DB에 입력

**자동화 목표**:
- n8n + AI Agent를 활용한 전체 자동화
- 2단계 파이프라인 (주제 선정 → 가이드북 생성)
- Supabase DB 자동 업로드

---

## 1단계: MCP 설정 (✅ 완료)

### n8n 환경 정보

| 항목 | 값 |
|------|-----|
| n8n 서버 URL (ngrok) | `https://semiformal-uncaptiously-lyman.ngrok-free.dev` |
| n8n 로컬 URL | `http://localhost:5678` |
| MCP 설정 (Antigravity) | `C:\Users\PC\.gemini\antigravity\mcp_config.json` |
| Supabase URL | `https://jogjurkmqfqbwfbhbvwl.supabase.co` |

---

## 2단계: 커스텀 스킬 / 프롬프트 (✅ 완료)

### 생성된 프롬프트 목록

| 파일 | 목적 | 상태 |
|------|------|------|
| `prompts/topic_selector.md` | 주제 선정 프롬프트 | ✅ 수정됨 (v2) |
| `prompts/guidebook_generator.md` | 가이드북 생성 프롬프트 | ✅ 수정됨 (v2) |

### v2 수정 사항
- **타겟 변경**: 대학생 → "AI를 배우고 싶은 모든 사람"
- **금지 주제 추가**: AIHub 플랫폼 개발/운영 관련 가이드 금지
- **허용 주제 명확화**: 사용자가 AI를 활용하는 모든 주제 (개발 포함)

---

## 3단계: n8n 워크플로우 (✅ 구현 완료)

### 워크플로우 1: 주제 선정

| 항목 | 값 |
|------|-----|
| **Workflow ID** | `XUlYV4s081gfhpYA` |
| **이름** | AIHub 주제 선정 v1 |
| **노드 수** | 7개 |
| **상태** | 비활성화 (Credentials 설정 필요) |
| **Webhook 경로** | `POST /webhook/topic-selector` |

**워크플로우 구조:**
```
[Manual Trigger / Webhook]
        ↓
[Set Category] - 카테고리 입력 처리
        ↓
[AI Agent - Topic Selector] ← [Google Gemini] + [Simple Memory]
        ↓
[Respond to Webhook] - Top 20 + Top 5 주제 반환
```

### 워크플로우 2: 가이드북 생성

| 항목 | 값 |
|------|-----|
| **Workflow ID** | `Kc9oe88ZBXgf4CzM` |
| **이름** | AIHub 가이드북 자동 생성 v2 |
| **노드 수** | 13개 |
| **상태** | 비활성화 (Credentials 설정 필요) |
| **Webhook 경로** | `POST /webhook/guidebook` |

**워크플로우 구조:**
```
[Manual Trigger / Webhook]
        ↓
[Set Input] - topic, category 동적 처리
        ↓
[AI Agent] ← [Google Gemini] + [Simple Memory]
        ↓
[Parse JSON] → [Validate Quality] → [If Valid]
                                       ↓
                           Pass: [Format for DB] → [Supabase Insert] → [Respond Success]
                           Fail: [Respond Error]
```

### 품질 검증 기준

```javascript
errors:
- Step 개수 < 6개
- copy_block < 3개
- branch < 2개
- prompt_pack < 4개

warnings:
- references < 8개
```

---

## 구현 단계

### Phase 1: 기반 설정 ✅ 완료
1. [x] n8n 환경 정보 확인 (n8n-운용-가이드.md)
2. [x] Antigravity용 `mcp_config.json` ngrok URL 설정
3. [x] MCP 연결 확인

### Phase 2: 프롬프트 수정 ✅ 완료
1. [x] `topic_selector.md` 수정 (타겟 변경, 금지 주제 추가)
2. [x] `guidebook_generator.md` 수정 (타겟 변경, 금지 주제 추가)

### Phase 3: n8n 워크플로우 ✅ 완료
1. [x] 주제 선정 워크플로우 생성 (`XUlYV4s081gfhpYA`)
2. [x] 가이드북 생성 워크플로우 수정 (`Kc9oe88ZBXgf4CzM`)
   - Set Input 동적화
   - AI Agent 프롬프트 업데이트
3. [x] autofix 적용 (expression format, typeVersion 수정)

### Phase 4: Supabase 연동 (진행 예정)
1. [ ] n8n UI에서 Credentials 설정
   - Google Gemini API
   - Supabase API
2. [ ] `guides` 테이블 스키마 확인/생성
3. [ ] 워크플로우 테스트 실행
4. [ ] E2E 테스트

---

## 사용법

### 1. 주제 선정 (워크플로우 1)

**Webhook 요청:**
```bash
curl -X POST https://semiformal-uncaptiously-lyman.ngrok-free.dev/webhook/topic-selector \
  -H "Content-Type: application/json" \
  -d '{"category": "취업 준비"}'
```

**응답:** Top 20 주제 + Top 5 상세 (JSON)

### 2. 가이드북 생성 (워크플로우 2)

**Webhook 요청:**
```bash
curl -X POST https://semiformal-uncaptiously-lyman.ngrok-free.dev/webhook/guidebook \
  -H "Content-Type: application/json" \
  -d '{"topic": "AI로 자기소개서 작성하기", "category": "취업 준비"}'
```

**응답:** 완성된 가이드북 JSON + Supabase 저장 결과

---

## 주요 참고 파일

| 파일 | 역할 |
|------|------|
| `가이드북-자동화-계획.md` | 전체 프로젝트 계획 및 진행 상황 |
| `.mcp.json` | n8n MCP 연결 설정 (프로젝트 폴더) |
| `prompts/topic_selector.md` | 주제 선정 프롬프트 |
| `prompts/guidebook_generator.md` | 가이드북 생성 프롬프트 |
| `이전 대화.md` | 대화 기록 |

---

## 추가 고려사항

### 비용 최적화
- 주제 선정: Gemini Flash (빠르고 저렴)
- 가이드북 생성: Gemini Flash 또는 GPT-4 (품질 중요)

### 에러 핸들링
- AI 응답 실패 시 재시도 로직
- 품질 검증 실패 시 에러 응답
- DB 업로드 실패 시 알림

### 확장성
- 다중 카테고리 병렬 처리
- 가이드북 업데이트 워크플로우
- 사용자 피드백 기반 개선
